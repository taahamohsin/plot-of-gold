```js
const povertyData = await FileAttachment("data/q3.csv").csv();
```


```js
  const margin = { top: 50, right: 20, bottom: 110, left: 70 };
  const width = 600 - margin.left - margin.right;
  const height = 450 - margin.top - margin.bottom;

  const svg = d3.create("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom + 100);

  const g = svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

  const valid = povertyData.filter(
    d => d.poverty_rate_6_85 != null &&
         d.poverty_rate_6_85 !== "" &&
         Number.isFinite(+d.poverty_rate_6_85)
  );

  const order = [
    "Low income",
    "Lower middle income",
    "Upper middle income",
    "High income",
    "Not classified"
  ];

  const grouped = d3.groups(valid, d => d.income_group)
    .map(([income_group, rows]) => {
      const values = rows.map(r => +r.poverty_rate_6_85).sort(d3.ascending);

      return {
        income_group,
        values,
        min: d3.min(values),
        q1: d3.quantile(values, 0.25),
        median: d3.quantile(values, 0.5),
        q3: d3.quantile(values, 0.75),
        max: d3.max(values)
      };
    })
    .filter(d => order.includes(d.income_group))
    .sort((a, b) => order.indexOf(a.income_group) - order.indexOf(b.income_group));

  const x = d3.scaleBand()
      .domain(grouped.map(d => d.income_group))
      .range([0, width])
      .padding(0.4);

  const y = d3.scaleLinear()
      .domain([
        d3.min(grouped, d => d.min),
        d3.max(grouped, d => d.max)
      ])
      .nice()
      .range([height, 0]);

  const xAxis = g.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x));

  xAxis.selectAll("text")
      .attr("transform", "rotate(90)")
      .style("text-anchor", "start")
      .attr("dx", "0.6em")
      .attr("dy", "0.1em");

  g.append("g").call(d3.axisLeft(y));

  g.append("text")
    .attr("x", width / 2)
    .attr("y", height + 125)
    .attr("text-anchor", "middle")
    .text("Income Group");

  g.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -(height / 2))
    .attr("y", -55)
    .attr("text-anchor", "middle")
    .text("Poverty Rate (%)");

  const boxColor = "#4682b4";

  g.selectAll(".whisker")
    .data(grouped)
    .enter()
    .append("line")
      .attr("class", "whisker")
      .attr("x1", d => x(d.income_group) + x.bandwidth() / 2)
      .attr("x2", d => x(d.income_group) + x.bandwidth() / 2)
      .attr("y1", d => y(d.min))
      .attr("y2", d => y(d.max))
      .attr("y2", d => y(d.max))
      .attr("stroke", "#E0E0E0");

  g.selectAll(".box")
    .data(grouped)
    .enter()
    .append("rect")
      .attr("class", "box")
      .attr("x", d => x(d.income_group))
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.q3))
      .attr("height", d => y(d.q1) - y(d.q3))
      .attr("fill", boxColor)

  g.selectAll(".median")
    .data(grouped)
    .enter()
    .append("line")
      .attr("class", "median")
      .attr("x1", d => x(d.income_group))
      .attr("x2", d => x(d.income_group) + x.bandwidth())
      .attr("y1", d => y(d.median))
      .attr("y2", d => y(d.median))
      .attr("stroke", "#FFD700")
      .attr("stroke-width", 2);

  g.append("text")
    .attr("x", width / 2)
    .attr("y", -25)
    .attr("text-anchor", "middle")
    .style("font-size", "22px")
    .style("font-weight", "600")
    .style("fill", "#f0f0f0")
    .text("Poverty Rate Distribution by Income Group");

   display(svg.node());
```

The boxplot of poverty rates across income groups shows the full distribution of poverty outcomes within each category. Low-income countries exhibit extremely high poverty rates that cluster tightly around 85-95%, indicating both high levels and low variability. Lower-middle-income countries have much wider dispersion, with poverty rates ranging from about 40% to over 90%, and a median in the mid-70s. Upper-middle-income countries show a dramatic shift downward, with most poverty rates falling between 10% and 35%. High-income countries display the lowest rates overall - medians near zero and only very small variation - and the “Not classified” group shows relatively high poverty concentrated around the mid-60s.

```js

  const margin = { top: 50, right: 20, bottom: 110, left: 70 };
  const width = 600 - margin.left - margin.right;
  const height = 450 - margin.top - margin.bottom;

  const svg = d3.create("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom + 20);

  const g = svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

  const valid = povertyData.filter(
    d => d.poverty_rate_6_85 != null && d.poverty_rate_6_85 !== "" && Number.isFinite(+d.poverty_rate_6_85)
  );

  const order = [
    "Low income",
    "Lower middle income",
    "Upper middle income",
    "High income",
    "Not classified"
  ];

  const grouped = d3.groups(valid, d => d.income_group)
    .map(([income_group, rows]) => ({
      income_group,
      median: d3.median(rows, r => +r.poverty_rate_6_85)
    }))
    .filter(d => order.includes(d.income_group))
    .sort((a, b) => order.indexOf(a.income_group) - order.indexOf(b.income_group));

  const x = d3.scaleBand()
      .domain(grouped.map(d => d.income_group))
      .range([0, width])
      .padding(0.2);

  const y = d3.scaleLinear()
      .domain([0, d3.max(grouped, d => d.median)])
      .nice()
      .range([height, 0]);

g.append("g")
  .attr("transform", `translate(0,${height})`)
  .call(d3.axisBottom(x))
  .selectAll("text")
    .attr("transform", "rotate(90)")
    .style("text-anchor", "start")
    .attr("dx", "0.8em")
    .attr("dy", "-0.2em");
  
  g.append("g")
    .call(d3.axisLeft(y));

  g.append("text")
    .attr("x", width / 2)
    .attr("y", height + 125)
    .attr("text-anchor", "middle")
    .text("Income Group");

  g.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -(height / 2))
    .attr("y", -55)
    .attr("text-anchor", "middle")
    .text("Median Poverty Rate (%)");

  g.append("text")
    .attr("x", width / 2)
    .attr("y", -25)
    .attr("text-anchor", "middle")
    .style("font-size", "22px")
    .style("font-weight", "600")
    .style("fill", "#f0f0f0")
    .text("Median Poverty Rate by Income Group");

  g.selectAll("rect")
    .data(grouped)
    .enter()
    .append("rect")
      .attr("x", d => x(d.income_group))
      .attr("y", d => y(d.median))
      .attr("width", x.bandwidth())
      .attr("height", d => height - y(d.median))
      .attr("fill", "#4682b4");

  display(svg.node());

```
The second visualization, a bar chart, summarizes the same data by showing the median poverty rate for each income group. Low-income countries have the highest median poverty rate (around 90%), followed by lower-middle-income countries (mid-70s). Upper-middle-income countries show a sharp decline to about 20%, and high-income countries display near-zero median poverty. The “Not classified” group again aligns more closely with lower-middle-income countries.

### What's our point?

Both visualizations provide strong and consistent evidence that higher-income countries have substantially lower poverty rates. As income level increases, the median poverty rate drops sharply, and the overall distribution of poverty narrows. Low- and lower-middle-income countries face persistently high poverty levels with wide variation, while upper-middle-income countries show substantially lower poverty, and high-income countries maintain near-zero poverty with minimal spread. Together, the boxplot and median bar chart clearly demonstrate a strong negative relationship between national income level and poverty: higher-income countries consistently experience far lower poverty rates.

As countries move from low to high income, poverty falls not just because they are richer, but because higher income enables the development of the institutional and economic systems that protect people from falling into poverty. Low-income countries typically rely on fragile agricultural or informal sectors and lack the infrastructure, government capacity, and public services needed to prevent widespread poverty. Middle-income countries show a wide range of poverty outcomes because development is uneven - some regions industrialize and diversify while others remain structurally underdeveloped. As countries advance further, they build stronger institutions, formal labor markets, and socio-economic mobility mechanisms such as education, social welfare, and healthcare, which stabilize incomes and reduce vulnerability. High-income countries therefore have consistently low poverty rates because their growth is supported by mature institutions and social protections. Ultimately, the decline in poverty is driven not by wealth alone, but by the capacity of economies and states to distribute the gains of growth broadly and to shield populations from systemic risk. Lower corruption may also play a role in reducing poverty, as it enables more equitable distribution of resources and reduces the risk of economic instability.