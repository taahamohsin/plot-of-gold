```js
import {darkModeColors} from "./components/colors.js";
```


```js
const envData = await FileAttachment("data/q4.csv").csv();
```

```js

  const margin = { top: 50, right: 160, bottom: 60, left: 80 };
  const width = 950 - margin.left - margin.right;
  const height = 500 - margin.top - margin.bottom;

  const svg = d3.create("svg")
    .attr("width", width + margin.left + margin.right + 100)
    .attr("height", height + margin.top + margin.bottom);

  const g = svg.append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);


  const filtered = envData.filter(d => 
    +d["Carbon intensity of GDP (kg CO2e per 2021 PPP $ of GDP)"] > 0 &&
    +d["GDP per capita (current US$)"] > 0
  );

  const x = d3.scaleLog()
    .domain(d3.extent(filtered, d => +d["GDP per capita (current US$)"]))
    .nice()
    .range([0, width]);

  const y = d3.scaleLog()
    .domain(d3.extent(filtered, d => 
      +d["Carbon intensity of GDP (kg CO2e per 2021 PPP $ of GDP)"]
    ))
    .nice()
    .range([height, 0]);

  const color = d3.scaleOrdinal()
    .domain([...new Set(filtered.map(d => d.income_group))])
    .range(darkModeColors);

  g.append("g")
    .attr("transform", `translate(0,${height})`)
    .call(
      d3.axisBottom(x)
        .ticks(10, "~s")
    );

  g.append("g")
    .call(
      d3.axisLeft(y)
        .ticks(10, "~s")
    );

  g.append("text")
    .attr("x", width / 2)
    .attr("y", height + 45)
    .attr("text-anchor", "middle")
    .text("GDP per capita (current US$, log scale)");

  g.append("text")
    .attr("transform", "rotate(-90)")
    .attr("x", -(height / 2))
    .attr("y", -55)
    .attr("text-anchor", "middle")
    .text("Carbon intensity of GDP (log scale)");

  d3.select("body").selectAll(".env-tooltip").remove();

  const tooltip = d3.select("body")
    .append("div")
    .attr("class", "env-tooltip")
    .style("position", "absolute")
    .style("background", "white")
    .style("padding", "8px 10px")
    .style("border", "1px solid #ccc")
    .style("border-radius", "4px")
    .style("pointer-events", "none")
    .style("opacity", 0)
    .style("font-size", "12px")
    .style("color", "black")
    ;

  g.selectAll("circle")
    .data(filtered)
    .enter()
    .append("circle")
      .attr("cx", d => x(+d["GDP per capita (current US$)"]))
      .attr("cy", d => y(+d["Carbon intensity of GDP (kg CO2e per 2021 PPP $ of GDP)"]))
      .attr("r", 6)
      .attr("fill", d => color(d.income_group))
      .attr("opacity", 0.7)
      .on("mouseover", (event, d) => {
        tooltip.style("opacity", 1).html(`
          <b>${d.country_name}</b><br>
          Income group: ${d.income_group}
        `);
      })
      .on("mousemove", event => {
        tooltip
          .style("left", event.pageX + 15 + "px")
          .style("top", event.pageY - 28 + "px");
      })
      .on("mouseleave", () => tooltip.style("opacity", 0));

  g.append("text")
    .attr("x", width / 2)
    .attr("y", -20)
    .attr("text-anchor", "middle")
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text("Is There a Trade-Off Between Economic Growth and Carbon Efficiency?");

  
  const legend = g.append("g")
    .attr("transform", `translate(${width + 20}, 20)`);

  legend.append("text")
    .attr("x", 0)
    .attr("y", -10)
    .style("font-size", "14px")
    .style("font-weight", "bold")
    .style("fill", "#f0f0f0")
    .text("Income Group");

  const incomeGroups = color.domain();

  incomeGroups.forEach((group, i) => {
    const row = legend.append("g")
      .attr("transform", `translate(0, ${i * 20})`);

    row.append("rect")
      .attr("width", 12)
      .attr("height", 12)
      .attr("fill", color(group));

    row.append("text")
      .attr("x", 20)
      .attr("y", 10)
      .style("font-size", "12px")
      .style("fill", "#e0e0e0")
      .text(group);
  });

  display(svg.node());

```

The scatterplot compares GDP per capita with the carbon intensity of GDP on log–log scales, using color to differentiate income groups. Across the full income spectrum, carbon intensity remains within a fairly tight band, and there is no upward trend suggesting that wealthier countries emit more carbon per unit of economic output. Low-income countries cluster at the lower end of intensity, while lower-middle- and upper-middle-income countries display higher and more dispersed values. High-income countries, despite much higher GDP per capita, generally occupy the lower end of the carbon-intensity range and show more consistency than middle-income countries.

```js

  const margin = { top: 50, right: 160, bottom: 80, left: 90 };
  const width = 740 - margin.left - margin.right;
  const height = 400 - margin.top - margin.bottom;

  const svg = d3.create("svg")
      .attr("width", width + margin.left + margin.right + 100)
      .attr("height", height + margin.top + margin.bottom + 60);

  const g = svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

  const filtered = envData.filter(d =>
    +d["Carbon intensity of GDP (kg CO2e per 2021 PPP $ of GDP)"] > 0
  );

  const order = [
    "Low income",
    "Lower middle income",
    "Upper middle income",
    "High income"
  ];

  const grouped = d3.groups(filtered, d => d.income_group)
    .map(([income_group, rows]) => {
      if (!order.includes(income_group)) return null;

      const values = rows
        .map(r => +r["Carbon intensity of GDP (kg CO2e per 2021 PPP $ of GDP)"])
        .filter(v => v > 0)
        .sort(d3.ascending);

      return {
        income_group,
        values,
        min: d3.min(values),
        q1: d3.quantile(values, 0.25),
        median: d3.quantile(values, 0.5),
        q3: d3.quantile(values, 0.75),
        max: d3.max(values)
      };
    })
    .filter(d => d !== null)
    .sort((a, b) => order.indexOf(a.income_group) - order.indexOf(b.income_group));

  const x = d3.scaleBand()
      .domain(order)
      .range([0, width])
      .padding(0.4);

  const y = d3.scaleLog()
      .domain([
        d3.min(grouped, d => d.min),
        d3.max(grouped, d => d.max)
      ])
      .nice()
      .range([height, 0]);

  const color = d3.scaleOrdinal()
      .domain(order)
      .range(darkModeColors);

  const xAxis = g.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x));

  xAxis.selectAll("text")
      .attr("transform", "rotate(90)")
      .style("text-anchor", "start")
      .attr("dx", "0.6em")
      .attr("dy", "0.2em");

  g.append("g")
      .call(d3.axisLeft(y).ticks(8, "~s"));

  g.append("text")
      .attr("x", width / 2)
      .attr("y", height + 130)
      .attr("text-anchor", "middle")
      .text("Income Group");

  g.append("text")
      .attr("transform", "rotate(-90)")
      .attr("x", -(height / 2))
      .attr("y", -60)
      .attr("text-anchor", "middle")
      .text("Carbon Intensity (kg CO₂ per PPP$ GDP, log scale)");

  g.selectAll(".whisker")
    .data(grouped)
    .enter()
    .append("line")
      .attr("class", "whisker")
      .attr("x1", d => x(d.income_group) + x.bandwidth() / 2)
      .attr("x2", d => x(d.income_group) + x.bandwidth() / 2)
      .attr("y1", d => y(d.min))
      .attr("y2", d => y(d.max))
      .attr("stroke", "#E0E0E0");

  g.selectAll(".box")
    .data(grouped)
    .enter()
    .append("rect")
      .attr("class", "box")
      .attr("x", d => x(d.income_group))
      .attr("width", x.bandwidth())
      .attr("y", d => y(d.q3))
      .attr("height", d => y(d.q1) - y(d.q3))
      .attr("fill", d => color(d.income_group))
      .attr("opacity", 0.6);

  g.selectAll(".median")
    .data(grouped)
    .enter()
    .append("line")
      .attr("class", "median")
      .attr("x1", d => x(d.income_group))
      .attr("x2", d => x(d.income_group) + x.bandwidth())
      .attr("y1", d => y(d.median))
      .attr("y2", d => y(d.median))
      .attr("stroke", "#FFD700")
      .attr("stroke-width", 2);

  g.append("text")
      .attr("x", width / 2)
      .attr("y", -20)
      .attr("text-anchor", "middle")
      .style("font-size", "18px")
      .style("font-weight", "bold")
      .text("Carbon Intensity Distribution by Income Group");

    const legend = g.append("g")
    .attr("transform", `translate(${width + 20}, 20)`);

    legend.append("text")
    .attr("x", 0)
    .attr("y", -10)
    .style("font-size", "14px")
    .style("font-weight", "bold")
    .style("fill", "#f0f0f0")
    .text("Income Group");

  const incomeGroups = color.domain();

  incomeGroups.forEach((group, i) => {
    const row = legend.append("g")
      .attr("transform", `translate(0, ${i * 20})`);

    row.append("rect")
      .attr("width", 12)
      .attr("height", 12)
      .attr("fill", color(group));

    row.append("text")
      .attr("x", 20)
      .attr("y", 10)
      .style("font-size", "12px")
      .style("fill", "#e0e0e0")
      .text(group);
  });

  display(svg.node());

```

The boxplot reinforces these patterns: carbon intensity tends to be lowest in low-income countries, rises among lower-middle- and upper-middle-income economies, and then declines again for high-income countries. This creates a U-shaped distribution in which the middle-income tiers exhibit the highest carbon intensity, whereas the richest countries show more efficient output relative to their emissions.

Surprisingly, the visualizations do not show a trade-off between economic growth and carbon efficiency in the present. A trade-off would imply that as countries grow richer (higher GDP per capita), they become less carbon-efficient—i.e., carbon intensity should rise with GDP. The evidence here shows the opposite. High-income countries have lower carbon intensity than both lower-middle and upper-middle-income countries. The scatterplot shows no positive relationship between GDP per capita and carbon intensity across the full range. Carbon intensity peaks in the middle, not at the top of the income distribution. Taken together, the charts indicate that middle-income economies tend to be the least carbon-efficient, likely due to energy mix and industrial structure. High-income economies tend to become more carbon-efficient, not less, as they grow—possibly due to cleaner energy, more efficient technologies, and economic shifts toward services