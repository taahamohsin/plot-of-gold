```js
import {darkModeColors} from "./components/colors.js";
```

```js 

const prospAndSust = await FileAttachment("data/prosperity_sustainability.csv").csv(); 

``` 

```js 
const dims = {
    width: 810,
    height: 620,
    margin_top: 60,
    margin_right: 200, 
    margin_bottom: 60,
    margin_left: 80
};

const innerWidth = dims.width - dims.margin_left - dims.margin_right;
const innerHeight = dims.height - dims.margin_top - dims.margin_bottom;

const svg = d3.create('svg')
    .attr('width', dims.width)
    .attr('height', dims.height);

const chart = svg.append('g')
    .attr('transform', `translate(${dims.margin_left}, ${dims.margin_top})`);

const gdpCol = "gdp per capita (current us$)";
const renewableCol = "renewable energy consumption (% of total final energy consumption)";

const regionMap = {
    "NAC": "North America",
    "ECS": "Europe & Central Asia",
    "EAS": "East Asia & Pacific",
    "LCN": "Latin America & Caribbean",
    "MEA": "Middle East & N. Africa",
    "SAS": "South Asia",
    "SSF": "Sub-Saharan Africa"
};
const regionCodes = Object.keys(regionMap);

const plotData = prospAndSust.map(d => ({
    gdp: +d[gdpCol],
    renewable: +d[renewableCol],
    country: d["country"],
    isRegion: regionCodes.includes(d["country"])
})).filter(d => d.gdp > 0 && typeof d.renewable === 'number');

const x_scale = d3.scaleLog()
    .domain(d3.extent(plotData, d => d.gdp))
    .range([0, innerWidth])
    .nice();

const y_scale = d3.scaleLinear()
    .domain([0, 100])
    .range([innerHeight, 0]);

const avgGDP = d3.mean(plotData, d => d.gdp);
const avgRen = d3.mean(plotData, d => d.renewable);

const regionColor = d3.scaleOrdinal()
    .domain(regionCodes)
    .range(darkModeColors);

chart.append("g").attr("class", "grid").attr("transform", `translate(0, ${innerHeight})`)
    .call(d3.axisBottom(x_scale).tickSize(-innerHeight).tickFormat("")).attr("opacity", 0.1);
chart.append("g").attr("class", "grid")
    .call(d3.axisLeft(y_scale).tickSize(-innerWidth).tickFormat("")).attr("opacity", 0.1);

chart.append("line")
    .attr("x1", x_scale(avgGDP)).attr("x2", x_scale(avgGDP))
    .attr("y1", 0).attr("y2", innerHeight)
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart.append("line")
    .attr("x1", 0).attr("x2", innerWidth)
    .attr("y1", y_scale(avgRen)).attr("y2", y_scale(avgRen))
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart.append("g").attr("transform", `translate(0, ${innerHeight})`).call(d3.axisBottom(x_scale).ticks(5, ".1s"));

chart.append("g").call(d3.axisLeft(y_scale));

// Create tooltip
d3.select("body").selectAll(".tooltip-q5-1").remove();

const tooltip = d3.select("body")
    .append("div")
    .attr("class", "tooltip-q5-1")
    .style("position", "absolute")
    .style("background", "white")
    .style("padding", "8px 10px")
    .style("border", "1px solid #ccc")
    .style("border-radius", "4px")
    .style("pointer-events", "none")
    .style("color", "black")
    .style("opacity", 0)
    .style("font-size", "12px");
    
chart.selectAll("circle")
    .data(plotData.sort((a, b) => a.isRegion - b.isRegion))
    .join("circle")
    .attr("cx", d => x_scale(d.gdp))
    .attr("cy", d => y_scale(d.renewable))
    .attr("r", d => d.isRegion ? 8 : 4)
    .style("fill", d => d.isRegion ? regionColor(d.country) : "steelblue")
    .style("opacity", d => d.isRegion ? 0.9 : 0.3)
    .style("stroke", d => d.isRegion ? "white" : "none")
    .style("stroke-width", d => d.isRegion ? 1.5 : 0)
    .style("cursor", "pointer")
    .on("mouseover", (event, d) => {
        tooltip.style("opacity", 1)
            .html(`
                <b>${d.country}</b><br>
                GDP: $${d3.format(",.0f")(d.gdp)}<br>
                Renewable: ${d3.format(".1f")(d.renewable)}%
            `);
    })
    .on("mousemove", (event) => {
        tooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 28) + "px");
    })
    .on("mouseleave", () => {
        tooltip.style("opacity", 0);
    });

chart.selectAll(".region-label")
    .data(plotData.filter(d => d.isRegion))
    .join("text")
    .attr("x", d => x_scale(d.gdp) + 10)
    .attr("y", d => y_scale(d.renewable) + 4)
    .text(d => d.country)
    .style("font-size", "11px")
    .style("font-weight", "bold")
    .style("fill", d => regionColor(d.country));

const legend = svg.append("g")
    .attr("transform", `translate(${dims.width - dims.margin_right + 20}, ${dims.margin_top})`);

legend.append("text").attr("x", 0).attr("y", 0).text("Region Codes").style("font-weight", "bold").style("font-size", "12px");

Object.entries(regionMap).forEach(([code, name], i) => {
    const row = legend.append("g").attr("transform", `translate(0, ${20 + i * 20})`);
    row.append("circle")
        .attr("cx", 6)
        .attr("cy", -3)
        .attr("r", 5)
        .attr("fill", regionColor(code));
    row.append("text").attr("x", 15).attr("y", 0).text(`${code}: ${name}`).style("font-size", "10px").attr("alignment-baseline", "middle");
});

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.margin_left + innerWidth / 2)
    .attr("y", dims.height - dims.margin_bottom / 2 + 20)
    .text("GDP Per Capita (Log Scale)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "rotate(-90)")
    .attr("y", dims.margin_left / 2)
    .attr("x", -(dims.margin_top + innerHeight / 2))
    .text("Renewable Energy Consumption (%)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.width / 2)
    .attr("y", dims.margin_top / 2)
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text("GDP vs. Renewable Energy Consumption");

display(svg.node());

```


```js
const dims2 = {
    width: 810,
    height: 620,
    margin_top: 60,
    margin_right: 200, 
    margin_bottom: 60,
    margin_left: 80
};

const innerWidth2 = dims2.width - dims2.margin_left - dims2.margin_right;
const innerHeight2 = dims2.height - dims2.margin_top - dims2.margin_bottom;

const svg2 = d3.create('svg')
    .attr('width', dims2.width)
    .attr('height', dims2.height);

const chart2 = svg2.append('g')
    .attr('transform', `translate(${dims2.margin_left}, ${dims2.margin_top})`);

const ghgCol = "total greenhouse gas emissions excluding lulucf per capita (t co2e/capita)";

const plotData2 = prospAndSust.map(d => ({
    gdp: +d[gdpCol],
    ghg: +d[ghgCol],
    country: d["country"],
    isRegion: regionCodes.includes(d["country"])
})).filter(d => d.gdp > 0 && d.ghg > 0);

const x_scale2 = d3.scaleLinear()
    .domain(d3.extent(plotData2, d => d.gdp))
    .range([0, innerWidth2])
    .nice();

const y_scale2 = d3.scaleLinear()
    .domain(d3.extent(plotData2, d => d.ghg))
    .range([innerHeight2, 0])
    .nice();

const avgGDP2 = d3.mean(plotData2, d => d.gdp);
const avgGHG = d3.mean(plotData2, d => d.ghg);

chart2.append("g").attr("class", "grid").attr("transform", `translate(0, ${innerHeight2})`)
    .call(d3.axisBottom(x_scale2).tickSize(-innerHeight2).tickFormat("")).attr("opacity", 0.1);
chart2.append("g").attr("class", "grid")
    .call(d3.axisLeft(y_scale2).tickSize(-innerWidth2).tickFormat("")).attr("opacity", 0.1);

chart2.append("line")
    .attr("x1", x_scale2(avgGDP2)).attr("x2", x_scale2(avgGDP2))
    .attr("y1", 0).attr("y2", innerHeight2)
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart2.append("line")
    .attr("x1", 0).attr("x2", innerWidth2)
    .attr("y1", y_scale2(avgGHG)).attr("y2", y_scale2(avgGHG))
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart2.append("g").attr("transform", `translate(0, ${innerHeight2})`).call(d3.axisBottom(x_scale2));
chart2.append("g").call(d3.axisLeft(y_scale2));

// Create tooltip for second chart
d3.select("body").selectAll(".tooltip-q5-2").remove();

const tooltip2 = d3.select("body")
    .append("div")
    .attr("class", "tooltip-q5-2")
    .style("position", "absolute")
    .style("background", "white")
    .style("padding", "8px 10px")
    .style("border", "1px solid #ccc")
    .style("border-radius", "4px")
    .style("pointer-events", "none")
    .style("color", "black")
    .style("opacity", 0)
    .style("font-size", "12px");

chart2.selectAll("circle")
    .data(plotData2.sort((a, b) => a.isRegion - b.isRegion))
    .join("circle")
    .attr("cx", d => x_scale2(d.gdp))
    .attr("cy", d => y_scale2(d.ghg))
    .attr("r", d => d.isRegion ? 8 : 4)
    .style("fill", d => d.isRegion ? regionColor(d.country) : "steelblue")
    .style("opacity", d => d.isRegion ? 0.9 : 0.3)
    .style("stroke", d => d.isRegion ? "white" : "none")
    .style("stroke-width", d => d.isRegion ? 1.5 : 0)
    .style("cursor", "pointer")
    .on("mouseover", (event, d) => {
        tooltip2.style("opacity", 1)
            .html(`
                <b>${d.country}</b><br>
                GDP: $${d3.format(",.0f")(d.gdp)}<br>
                GHG: ${d3.format(".2f")(d.ghg)} t CO2e/capita
            `);
    })
    .on("mousemove", (event) => {
        tooltip2
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 28) + "px");
    })
    .on("mouseleave", () => {
        tooltip2.style("opacity", 0);
    });

chart2.selectAll(".region-label")
    .data(plotData2.filter(d => d.isRegion))
    .join("text")
    .attr("x", d => x_scale2(d.gdp) + 10)
    .attr("y", d => y_scale2(d.ghg) + 4)
    .text(d => d.country)
    .style("font-size", "11px")
    .style("font-weight", "bold")
    .style("fill", d => regionColor(d.country));

const legend2 = svg2.append("g")
    .attr("transform", `translate(${dims2.width - dims2.margin_right + 20}, ${dims2.margin_top})`);

legend2.append("text").attr("x", 0).attr("y", 0).text("Region Codes").style("font-weight", "bold").style("font-size", "12px");

Object.entries(regionMap).forEach(([code, name], i) => {
    const row = legend2.append("g").attr("transform", `translate(0, ${20 + i * 20})`);
    row.append("circle")
        .attr("cx", 6)
        .attr("cy", -3)
        .attr("r", 5)
        .attr("fill", regionColor(code));
    row.append("text").attr("x", 15).attr("y", 0).text(`${code}: ${name}`).style("font-size", "10px").attr("alignment-baseline", "middle");
});

svg2.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims2.margin_left + innerWidth2 / 2)
    .attr("y", dims2.height - dims2.margin_bottom / 2 + 20)
    .text("GDP Per Capita (Current US$)");

svg2.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "rotate(-90)")
    .attr("y", dims2.margin_left / 2)
    .attr("x", -(dims2.margin_top + innerHeight2 / 2))
    .text("GHG Emissions (t CO2e/capita)");

svg2.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims2.width / 2)
    .attr("y", dims2.margin_top / 2)
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text("GDP vs. GHG Emissions");

display(svg2.node());
```

For both graphs, we had plotted the average of each region. These two visualizations directly show how a country's GDP may affect their sustainability efforts through their total greenhouse gas emissions and how much renewable energy they use. Ideally, in the first visualization, the countries with a higher GDP will also have a lower total greenhouse gas emission. However, as countries develop, the factories they create may not be the most environmentally friendly. In the second visualization, we had originally expected the countries with a higher GDP to have a higher renewable energy consumption. However, what ended up being shown is that the countries with a lower GDP have a higher rate of using renewable energy. The last visualization shows the correlation between poverty and air pollution. 

## So What?
As seen from LCS, Latin America and Caribbean, and ECS, Europe and Central Asia, it is clear that there are at least two ways trying to maintain the balance of growing the economy and sustainability. LCS clearly focused more on sustainbility and ECS focused on GDP. Additionally, LCS is a great example of how to be more sustainable than countries that have a higher GDP. 