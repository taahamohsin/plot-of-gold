```js 

const prospAndSust = await FileAttachment("data/prosperity_sustainability.csv").csv(); 

``` 

```js 
// ------- Graph 1 GDP vs Renewable Energy Consumption 
const dims = {
    width: 810,
    height: 620,
    margin_top: 60,
    margin_right: 200, // Increased for legend
    margin_bottom: 60,
    margin_left: 80
};

const innerWidth = dims.width - dims.margin_left - dims.margin_right;
const innerHeight = dims.height - dims.margin_top - dims.margin_bottom;

const svg = d3.create('svg')
    .attr('width', dims.width)
    .attr('height', dims.height);

const chart = svg.append('g')
    .attr('transform', `translate(${dims.margin_left}, ${dims.margin_top})`);

const gdpCol = "gdp per capita (current us$)";
const renewableCol = "renewable energy consumption (% of total final energy consumption)";

// Region Definitions
const regionMap = {
    "NAC": "North America",
    "ECS": "Europe & Central Asia",
    "EAS": "East Asia & Pacific",
    "LCN": "Latin America & Caribbean",
    "MEA": "Middle East & N. Africa",
    "SAS": "South Asia",
    "SSF": "Sub-Saharan Africa"
};
const regionCodes = Object.keys(regionMap);

const plotData = prospAndSust.map(d => ({
    gdp: +d[gdpCol],
    renewable: +d[renewableCol],
    country: d["country"],
    isRegion: regionCodes.includes(d["country"])
})).filter(d => d.gdp > 0 && typeof d.renewable === 'number');

// Scales
const x_scale = d3.scaleLog()
    .domain(d3.extent(plotData, d => d.gdp))
    .range([0, innerWidth])
    .nice();

const y_scale = d3.scaleLinear()
    .domain([0, 100])
    .range([innerHeight, 0]);

// Averages for Reference Lines
const avgGDP = d3.mean(plotData, d => d.gdp);
const avgRen = d3.mean(plotData, d => d.renewable);

// Gridlines
chart.append("g").attr("class", "grid").attr("transform", `translate(0, ${innerHeight})`)
    .call(d3.axisBottom(x_scale).tickSize(-innerHeight).tickFormat("")).attr("opacity", 0.1);
chart.append("g").attr("class", "grid")
    .call(d3.axisLeft(y_scale).tickSize(-innerWidth).tickFormat("")).attr("opacity", 0.1);

// Reference Lines
chart.append("line")
    .attr("x1", x_scale(avgGDP)).attr("x2", x_scale(avgGDP))
    .attr("y1", 0).attr("y2", innerHeight)
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart.append("line")
    .attr("x1", 0).attr("x2", innerWidth)
    .attr("y1", y_scale(avgRen)).attr("y2", y_scale(avgRen))
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

// Axes
chart.append("g").attr("transform", `translate(0, ${innerHeight})`).call(d3.axisBottom(x_scale).ticks(5, ".1s"));
chart.append("g").call(d3.axisLeft(y_scale));

// Draw Circles (Regions on top)
chart.selectAll("circle")
    .data(plotData.sort((a, b) => a.isRegion - b.isRegion))
    .join("circle")
    .attr("cx", d => x_scale(d.gdp))
    .attr("cy", d => y_scale(d.renewable))
    .attr("r", d => d.isRegion ? 8 : 4)
    .style("fill", d => d.isRegion ? "#ff5722" : "steelblue")
    .style("opacity", d => d.isRegion ? 1 : 0.3)
    .style("stroke", d => d.isRegion ? "black" : "none");

// Labels for Regions
chart.selectAll(".region-label")
    .data(plotData.filter(d => d.isRegion))
    .join("text")
    .attr("x", d => x_scale(d.gdp) + 10)
    .attr("y", d => y_scale(d.renewable) + 4)
    .text(d => d.country)
    .style("font-size", "11px")
    .style("font-weight", "bold")
    .style("fill", "#d84315");

// LEGEND
const legend = svg.append("g")
    .attr("transform", `translate(${dims.width - dims.margin_right + 20}, ${dims.margin_top})`);

legend.append("text").attr("x", 0).attr("y", 0).text("Region Codes").style("font-weight", "bold").style("font-size", "12px");

Object.entries(regionMap).forEach(([code, name], i) => {
    const row = legend.append("g").attr("transform", `translate(0, ${20 + i * 20})`);
    row.append("text").attr("x", 0).attr("y", 0).text(`${code}: ${name}`).style("font-size", "10px").attr("alignment-baseline", "middle");
});

// Titles
svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.margin_left + innerWidth / 2)
    .attr("y", dims.height - dims.margin_bottom / 2 + 20)
    .text("GDP Per Capita (Log Scale)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "rotate(-90)")
    .attr("y", dims.margin_left / 2)
    .attr("x", -(dims.margin_top + innerHeight / 2))
    .text("Renewable Energy Consumption (%)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.width / 2)
    .attr("y", dims.margin_top / 2)
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text("GDP vs. Renewable Energy Consumption");

display(svg.node());

```


```js
// ----------- Graph 2 GDP vs Green House Gas Emission 
const dims = {
    width: 810,
    height: 620,
    margin_top: 60,
    margin_right: 200, // Increased margin for legend
    margin_bottom: 60,
    margin_left: 80
};

const innerWidth = dims.width - dims.margin_left - dims.margin_right;
const innerHeight = dims.height - dims.margin_top - dims.margin_bottom;

const svg = d3.create('svg')
    .attr('width', dims.width)
    .attr('height', dims.height);

const chart = svg.append('g')
    .attr('transform', `translate(${dims.margin_left}, ${dims.margin_top})`);

const gdpCol = "gdp per capita (current us$)";
const ghgCol = "total greenhouse gas emissions excluding lulucf per capita (t co2e/capita)";

// Region Definitions
const regionMap = {
    "NAC": "North America",
    "ECS": "Europe & Central Asia",
    "EAS": "East Asia & Pacific",
    "LCN": "Latin America & Caribbean",
    "MEA": "Middle East & N. Africa",
    "SAS": "South Asia",
    "SSF": "Sub-Saharan Africa"
};
const regionCodes = Object.keys(regionMap);

const plotData = prospAndSust.map(d => ({
    gdp: +d[gdpCol],
    ghg: +d[ghgCol],
    country: d["country"],
    isRegion: regionCodes.includes(d["country"])
})).filter(d => d.gdp > 0 && d.ghg > 0);

// Scales
const x_scale = d3.scaleLinear()
    .domain(d3.extent(plotData, d => d.gdp))
    .range([0, innerWidth])
    .nice();

const y_scale = d3.scaleLinear()
    .domain(d3.extent(plotData, d => d.ghg))
    .range([innerHeight, 0])
    .nice();

// Averages for Reference Lines
const avgGDP = d3.mean(plotData, d => d.gdp);
const avgGHG = d3.mean(plotData, d => d.ghg);

// Gridlines
chart.append("g").attr("class", "grid").attr("transform", `translate(0, ${innerHeight})`)
    .call(d3.axisBottom(x_scale).tickSize(-innerHeight).tickFormat("")).attr("opacity", 0.1);
chart.append("g").attr("class", "grid")
    .call(d3.axisLeft(y_scale).tickSize(-innerWidth).tickFormat("")).attr("opacity", 0.1);

// Reference Lines (Averages)
chart.append("line")
    .attr("x1", x_scale(avgGDP)).attr("x2", x_scale(avgGDP))
    .attr("y1", 0).attr("y2", innerHeight)
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

chart.append("line")
    .attr("x1", 0).attr("x2", innerWidth)
    .attr("y1", y_scale(avgGHG)).attr("y2", y_scale(avgGHG))
    .attr("stroke", "gray").attr("stroke-dasharray", "4").attr("opacity", 0.5);

// Axes
chart.append("g").attr("transform", `translate(0, ${innerHeight})`).call(d3.axisBottom(x_scale));
chart.append("g").call(d3.axisLeft(y_scale));

// Draw Circles (Regions on top)
chart.selectAll("circle")
    .data(plotData.sort((a, b) => a.isRegion - b.isRegion))
    .join("circle")
    .attr("cx", d => x_scale(d.gdp))
    .attr("cy", d => y_scale(d.ghg))
    .attr("r", d => d.isRegion ? 8 : 4)
    .style("fill", d => d.isRegion ? "#ff5722" : "steelblue")
    .style("opacity", d => d.isRegion ? 1 : 0.3)
    .style("stroke", d => d.isRegion ? "black" : "none");

// Labels for Regions
chart.selectAll(".region-label")
    .data(plotData.filter(d => d.isRegion))
    .join("text")
    .attr("x", d => x_scale(d.gdp) + 10)
    .attr("y", d => y_scale(d.ghg) + 4)
    .text(d => d.country)
    .style("font-size", "11px")
    .style("font-weight", "bold")
    .style("fill", "#d84315");

// LEGEND
const legend = svg.append("g")
    .attr("transform", `translate(${dims.width - dims.margin_right + 20}, ${dims.margin_top})`);

legend.append("text").attr("x", 0).attr("y", 0).text("Region Codes").style("font-weight", "bold").style("font-size", "12px");

Object.entries(regionMap).forEach(([code, name], i) => {
    const row = legend.append("g").attr("transform", `translate(0, ${20 + i * 20})`);
    row.append("text").attr("x", 0).attr("y", 0).text(`${code}: ${name}`).style("font-size", "10px").attr("alignment-baseline", "middle");
});

// Titles
svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.margin_left + innerWidth / 2)
    .attr("y", dims.height - dims.margin_bottom / 2 + 20)
    .text("GDP Per Capita (Current US$)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "rotate(-90)")
    .attr("y", dims.margin_left / 2)
    .attr("x", -(dims.margin_top + innerHeight / 2))
    .text("GHG Emissions (t CO2e/capita)");

svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.width / 2)
    .attr("y", dims.margin_top / 2)
    .style("font-size", "18px")
    .style("font-weight", "bold")
    .text("GDP vs. GHG Emissions");

display(svg.node());
```

For both graphs, we had plotted the average of each region. These two visualizations directly show how a country's GDP may affect their sustainability efforts through their total greenhouse gas emissions and how much renewable energy they use. Ideally, in the first visualization, the countries with a higher GDP will also have a lower total greenhouse gas emission. However, as countries develop, the factories they create may not be the most environmentally friendly. In the second visualization, we had originally expected the countries with a higher GDP to have a higher renewable energy consumption. However, what ended up being shown is that the countries with a lower GDP have a higher rate of using renewable energy. The last visualization shows the correlation between poverty and air pollution. 

## So What?
As seen from LCS, Latin America and Caribbean, and ECS, Europe and Central Asia, it is clear that there are at least two ways trying to maintain the balance of growing the economy and sustainability. LCS clearly focused more on sustainbility and ECS focused on GDP. Additionally, LCS is a great example of how to be more sustainable than countries that have a higher GDP. 