```js
import {darkModeColors} from "./components/colors.js";
```

```js
const gapCsv = await FileAttachment("data/education_health_gap_data.csv").csv(); 
```

```js 

const dims = {
    width: 810,   
    height: 620,  
    margin_top: 60,
    margin_right: 150,
    margin_bottom: 60,
    margin_left: 80
  };

  const innerWidth = dims.width - dims.margin_left - dims.margin_right;
  const innerHeight = dims.height - dims.margin_top - dims.margin_bottom;

  const svg = d3.create('svg')
    .attr('width', dims.width)
    .attr('height', dims.height);

  const chart = svg.append('g')
    .attr('transform', `translate(${dims.margin_left}, ${dims.margin_top})`);
    
  const highIncomeCountries = new Set([
    "USA", "DEU", "JPN", "GBR", "CAN", "FRA", "AUS", "NOR", "SWE"
  ]);

  const developingCountries = new Set([
    "BRA", "RUS", "IND", "CHN", "ZAF",
    "NGA", "PAK", "BGD", "MEX", "IDN", "ETH", "EGY"
  ]);

  function assignGroup(country) {
    if (highIncomeCountries.has(country)) {
      return "High-Income";
    }
    if (developingCountries.has(country)) {
      return "Developing";
    }
    return null;
  }

  const metricCol = "primary completion rate, total (% of relevant age group)";
  
  const processedData = gapCsv.map(d => ({
    year: d3.timeParse("%Y")(d.year), 
    group: assignGroup(d.country),
    value: +d[metricCol]
  })).filter(d => 
    d.group && !isNaN(d.value) && d.year && d.value > 0
  );
  
  const avgData = d3.rollup(
    processedData,
    v => d3.mean(v, d => d.value), 
    d => d.year,                   
    d => d.group                 
  );
  
  const flatData = [];
  for (const [year, groups] of avgData) {
    for (const [group, value] of groups) {
      flatData.push({ year, group, value });
    }
  }

  const x_scale = d3.scaleTime()
    .domain(d3.extent(flatData, d => d.year))
    .range([0, innerWidth]);

  const y_scale = d3.scaleLinear()
    .domain([0, 100])
    .range([innerHeight, 0])
    .nice();
    
  const colorScale = d3.scaleOrdinal()
    .domain(["High-Income", "Developing"])
    .range(darkModeColors); 

  chart.append("g")
    .attr("transform", `translate(0, ${innerHeight})`)
    .call(d3.axisBottom(x_scale))
    .selectAll("text")
    .style("fill", "#e0e0e0");

  chart.append("g")
    .call(d3.axisLeft(y_scale).ticks(10))
    .selectAll("text")
    .style("fill", "#e0e0e0"); 

  const lineGenerator = d3.line()
    .x(d => x_scale(d.year))
    .y(d => y_scale(d.value))
    .curve(d3.curveMonotoneX); 
    
  const groupedForLines = d3.group(flatData, d => d.group);

  chart.selectAll(".line-path")
    .data(groupedForLines)
    .enter()
    .append("path")
      .attr("class", "line-path")
      .attr("d", d => lineGenerator(d[1].sort((a, b) => a.year - b.year)))
      .style("fill", "none")
      .style("stroke", d => colorScale(d[0]))
      .style("stroke-width", 3)
      .style("opacity", 0.9);

  const legend = svg.append("g")
    .attr("transform", `translate(${dims.margin_left + innerWidth + 20}, ${dims.margin_top})`);
  
  legend.append("text")
    .attr("x", 0)
    .attr("y", -10)
    .attr("font-size", "16px")
    .attr("font-weight", "600")
    .style("fill", "#f0f0f0")
    .text("Country Group");
    
  colorScale.domain().forEach((group, i) => {
    const legendRow = legend.append("g")
      .attr("transform", `translate(0, ${i * 25 + 10})`);
      
    legendRow.append("rect")
      .attr("width", 15)
      .attr("height", 15)
      .attr("fill", colorScale(group))
      .attr("opacity", 0.9);
      
    legendRow.append("text")
      .attr("x", 22)
      .attr("y", 12)
      .style("font-size", "13px")
      .style("fill", "#e0e0e0")
      .text(group);
  });

  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.width / 2)
    .attr("y", dims.margin_top / 2)
    .style("font-size", "22px")
    .style("font-weight", "600")
    .style("fill", "#f0f0f0")
    .text("Education Gap: High-Income vs. Developing Nations");

  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("x", dims.margin_left + innerWidth / 2)
    .attr("y", dims.height - dims.margin_bottom / 2 + 20)
    .style("font-size", "17px")
    .style("fill", "#e0e0e0")
    .text("Year");

  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "rotate(-90)")
    .attr("y", dims.margin_left / 2 - 10)
    .attr("x", -(dims.margin_top + innerHeight / 2))
    .style("font-size", "17px")
    .style("fill", "#e0e0e0")
    .text("Primary Completion Rate (%)");

  display(svg.node());

```

This chart shows the completion rate of primary school education with two lines. The blue line represents the high income countries and orange line represents developing countries. What is shown in the graph is that at one point, the developing countries had a higher primary completion rate than developing countries and later on, they became almost equal. This shows that the gap between developing and high income countries is decreasing and shows the foundations of the education field in developing countries is quickly increasing.

```js 

const dims = {
  width: 810,   
  height: 620,  
  margin_top: 60,
  margin_right: 150,
  margin_bottom: 60,
  margin_left: 80
};

const innerWidth = dims.width - dims.margin_left - dims.margin_right;
const innerHeight = dims.height - dims.margin_top - dims.margin_bottom;

const svg = d3.create('svg')
  .attr('width', dims.width)
  .attr('height', dims.height);

const chart = svg.append('g')
  .attr('transform', `translate(${dims.margin_left}, ${dims.margin_top})`);
  
const highIncomeCountries = new Set([
  "USA", "DEU", "JPN", "GBR", "CAN", "FRA", "AUS", "NOR", "SWE"
]);

const developingCountries = new Set([
  "BRA", "RUS", "IND", "CHN", "ZAF",
  "NGA", "PAK", "BGD", "MEX", "IDN", "ETH", "EGY"
]);

function assignGroup(country) {
  if (highIncomeCountries.has(country)) return "High-Income";
  if (developingCountries.has(country)) return "Developing";
  return null;
}

const metricCol = "poverty headcount ratio at $6.85 a day (2017 ppp) (% of population)";

const processedData = gapCsv.map(d => ({
  year: d3.timeParse("%Y")(d.year), 
  group: assignGroup(d.country),
  value: +d[metricCol]
})).filter(d => 
  d.group && !isNaN(d.value) && d.year && d.value > 0
);

const avgData = d3.rollup(
  processedData,
  v => d3.mean(v, d => d.value), 
  d => d.year,                   
  d => d.group                 
);

const flatData = [];
for (const [year, groups] of avgData) {
  for (const [group, value] of groups) {
    flatData.push({ year, group, value });
  }
}

const x_scale = d3.scaleTime()
  .domain(d3.extent(flatData, d => d.year))
  .range([0, innerWidth]);

const y_scale = d3.scaleLinear()
  .domain([0, 100]) 
  .range([innerHeight, 0])
  .nice();
  
const colorScale2 = d3.scaleOrdinal()
  .domain(["High-Income", "Developing"])
  .range(darkModeColors); 

chart.append("g")
  .attr("transform", `translate(0, ${innerHeight})`)
  .call(d3.axisBottom(x_scale))
  .selectAll("text")
  .style("fill", "#e0e0e0");

chart.append("g")
  .call(d3.axisLeft(y_scale).ticks(10))
  .selectAll("text")
  .style("fill", "#e0e0e0"); 

const lineGenerator = d3.line()
  .x(d => x_scale(d.year))
  .y(d => y_scale(d.value))
  .curve(d3.curveMonotoneX); 
  
const groupedForLines = d3.group(flatData, d => d.group);

chart.selectAll(".line-path")
  .data(groupedForLines)
  .enter()
  .append("path")
    .attr("class", "line-path")
    .attr("d", d => lineGenerator(d[1].sort((a, b) => a.year - b.year)))
    .style("fill", "none")
    .style("stroke", d => colorScale2(d[0]))
    .style("stroke-width", 3)
    .style("opacity", 0.9);

const legend2 = svg.append("g")
  .attr("transform", `translate(${dims.margin_left + innerWidth + 20}, ${dims.margin_top})`);

legend2.append("text")
  .attr("x", 0)
  .attr("y", -10)
  .attr("font-size", "16px")
  .attr("font-weight", "600")
  .style("fill", "#f0f0f0")
  .text("Country Group");
  
colorScale2.domain().forEach((group, i) => {
  const legendRow = legend2.append("g")
    .attr("transform", `translate(0, ${i * 25 + 10})`);
    
  legendRow.append("rect")
    .attr("width", 15)
    .attr("height", 15)
    .attr("fill", colorScale2(group))
    .attr("opacity", 0.9);
    
  legendRow.append("text")
    .attr("x", 22)
    .attr("y", 12)
    .style("font-size", "13px")
    .style("fill", "#e0e0e0")
    .text(group);
});

svg.append("text")
  .attr("text-anchor", "middle")
  .attr("x", dims.width / 2)
  .attr("y", dims.margin_top / 2)
  .style("font-size", "22px")
  .style("font-weight", "600")
  .style("fill", "#f0f0f0")
  .text("The Well-being Gap: Poverty Headcount ($6.85/day)");

svg.append("text")
  .attr("text-anchor", "middle")
  .attr("x", dims.margin_left + innerWidth / 2)
  .attr("y", dims.height - dims.margin_bottom / 2 + 20)
  .style("font-size", "17px")
  .style("fill", "#e0e0e0")
  .text("Year");

svg.append("text")
  .attr("text-anchor", "middle")
  .attr("transform", "rotate(-90)")
  .attr("y", dims.margin_left / 2 - 10)
  .attr("x", -(dims.margin_top + innerHeight / 2))
  .style("font-size", "17px")
  .style("fill", "#e0e0e0")
  .text("% of Population in Poverty");

display(svg.node());

```

## Yipee! 
Clearly, from the first graph of primary education completion, the gap in education between developing and high income countries is narrowing, which means that more opportunity is opening up for those in developing countries. Additionally, from the second graph, it looks like that there are slowly more people getting out of poverty, which is a good sign that things are becoming more equal/equitable.